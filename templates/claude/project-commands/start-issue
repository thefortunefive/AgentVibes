#!/bin/bash
# Start work on an issue for {{emoji}} {{name}}

if [ -z "$1" ]; then
    echo "Usage: start-issue <issue_number>"
    echo "Example: start-issue 42"
    exit 1
fi

issue_num="$1"

echo "üöÄ {{emoji}} {{name}} starting work on issue #$issue_num..."

# Check if gh is available
if ! command -v gh &> /dev/null; then
    echo "‚ùå GitHub CLI (gh) is required but not installed"
    exit 1
fi

# Add in-progress label
gh issue edit $issue_num --add-label "in-progress"

# Add comment
gh issue comment $issue_num --body "{{emoji}} {{name}} says: Starting work on this issue! {{#each personality.catchphrases}}{{#if @first}}{{this}}{{/if}}{{/each}}"

# Update project board status (requires jq)
if command -v jq &> /dev/null; then
    echo "üìä Updating project board..."
    item_id=$(gh project item-list {{projectId}} --owner {{owner}} --limit 1000 --format json | jq -r ".items[] | select(.content.number == $issue_num) | .id")
    
    if [ ! -z "$item_id" ]; then
        # Move to In Progress (you may need to adjust the field ID)
        gh project item-edit --project-id {{projectId}} --id $item_id --field-id {{statusFieldId}} --single-select-option-id IN_PROGRESS_ID
        echo "‚úÖ Moved issue #$issue_num to In Progress"
    else
        echo "‚ö†Ô∏è Could not find issue #$issue_num in project board"
    fi
else
    echo "‚ö†Ô∏è jq not available - project board not updated automatically"
    echo "üí° Install jq for automatic project board updates"
fi

echo ""
echo "‚úÖ {{emoji}} {{name}} is now working on issue #$issue_num"
echo "üîó View issue: https://github.com/{{owner}}/{{repo}}/issues/$issue_num"
echo ""
echo "{{emoji}} {{name}} says: \"{{#each personality.catchphrases}}{{#if @first}}{{this}}{{/if}}{{/each}}\""